# MyDictionary - 产品设计文档

## 一、产品定位

一款基于本地 AI 模型的 Chrome 浏览器插件,提供智能翻译、近义词推荐和例句展示功能,无需联网即可使用。

## 二、核心功能

### 2.1 划词翻译 (Quick Translation)
**触发方式**: 鼠标选中网页文本

**交互流程**:
1. 用户在任意网页选中文本(单词、短语或句子)
2. 选中文本附近出现翻译图标按钮 (或右键菜单中出现"翻译"选项)
3. 点击图标/菜单项
4. 在选中文本旁边弹出小型浮窗,显示翻译结果
5. 浮窗包含:
   - 原文
   - 翻译结果
   - "详情"按钮 → 点击后打开侧边栏深度查询

**UI 设计要点**:
- 浮窗大小: 约 200x100px,自适应内容
- 位置: 选中文本下方居中,若空间不足则显示在上方
- 自动消失: 3 秒后淡出,或点击网页其他区域关闭
- 支持复制翻译结果

---

### 2.2 侧边栏深度查询 (Sidebar Panel)
**触发方式**:
- 方式 1: 选中文本 + 快捷键 `Ctrl+Shift+F` (Mac: `Cmd+Shift+F`)
- 方式 2: 从划词翻译浮窗点击"详情"按钮

**交互流程**:
1. 用户选中文本并按下快捷键
2. 网页右侧滑出 400px 宽的侧边栏面板
3. 侧边栏自动显示:
   - **翻译区域**:
     - 原文(带语言标识)
     - 翻译结果
     - 语言方向自动判断(中→英 或 英→中)
   - **上下文预览**: 显示选中文本所在的完整句子
4. 用户可点击功能按钮获取更多信息:
   - **[近义词]** 按钮 → 展开显示 5-10 个同义词
   - **[例句]** 按钮 → 展开显示 3-5 个真实使用场景的例句

**UI 设计要点**:
- 侧边栏宽度: 400px (固定)
- 滑入动画: 0.3 秒缓动动画 (cubic-bezier)
- 关闭方式:
  - 点击侧边栏左上角的 ✕ 按钮
  - 再次按下快捷键 `Ctrl+Shift+F`
  - 按下 `Esc` 键
- 侧边栏内容分区:
  ```
  ┌─────────────────────────────┐
  │  ✕  MyDictionary            │ ← Header
  ├─────────────────────────────┤
  │  原文: [语言标识]            │
  │  "selected text"            │
  │                             │
  │  翻译: [语言标识]            │
  │  "translation result"       │
  ├─────────────────────────────┤
  │  📝 上下文                   │
  │  "...完整句子..."            │
  ├─────────────────────────────┤
  │  [近义词]  [例句]            │ ← 功能按钮
  │                             │
  │  [近义词内容展开区域]         │
  │  或                          │
  │  [例句内容展开区域]           │
  └─────────────────────────────┘
  ```

---

## 三、语言检测逻辑

### 3.1 自动检测规则
```
IF 中文字符数 / 总字符数 > 30%:
    源语言 = 中文
    目标语言 = 英文
ELSE:
    源语言 = 英文
    目标语言 = 中文
```

### 3.2 边缘情况处理
- **混合语言**: 优先按主要语言判断
- **纯数字/符号**: 默认识别为英文
- **特殊语言**: 暂不支持(如日语、韩语),后续版本扩展

---

## 四、功能按钮设计

### 4.1 近义词列表
**点击后展示**:
- 5-10 个同义词,按相关性排序
- 每个同义词可点击,点击后替换原文并重新翻译
- 示例:
  ```
  原文: "happy"

  近义词:
  • joyful
  • delighted
  • pleased
  • cheerful
  • content
  ```

### 4.2 例句展示
**点击后展示**:
- 3-5 个真实使用场景的句子
- 句子中高亮显示目标词汇
- 每个例句下方显示翻译(可折叠)
- 示例:
  ```
  例句:

  1. I'm **happy** to help you with this project.
     (我很高兴能帮助你完成这个项目。)

  2. She looks **happy** today.
     (她今天看起来很开心。)

  3. We had a **happy** ending to our trip.
     (我们的旅行有一个圆满的结局。)
  ```

---

## 五、技术架构设计

### 5.1 模型选型

| 功能 | 模型 | 大小 | 加载策略 |
|------|------|------|----------|
| **翻译(中英互译)** | `Xenova/nllb-200-distilled-600M` | ~600MB | 插件启动时优先加载 |
| **近义词** | `Xenova/distilbert-base-uncased` | ~65MB | 延迟加载(启动后 3 秒) |
| **例句检索** | `Xenova/all-MiniLM-L6-v2` | ~23MB | 延迟加载(启动后 3 秒) |

**总体积**: ~690MB (完整加载)

### 5.2 性能优化策略
1. **分层加载**: 核心翻译功能优先,扩展功能后台加载
2. **缓存机制**: 翻译结果缓存到 `chrome.storage.local`
3. **懒加载**: 近义词和例句仅在用户点击对应按钮时才执行推理
4. **WebGPU 加速**: Transformers.js 自动启用 GPU 加速

### 5.3 数据流设计

```
[网页用户交互]
      ↓
[Content Script]
      ↓ (chrome.runtime.sendMessage)
[Service Worker]
      ↓ (调用 AI 模型)
[Transformers.js Pipeline]
      ↓ (返回结果)
[Service Worker]
      ↓ (sendResponse)
[Content Script]
      ↓ (更新 UI)
[侧边栏/浮窗显示]
```

---

## 六、用户体验优化

### 6.1 加载状态提示
- 首次加载模型时,侧边栏显示进度条
- 翻译过程中显示 Loading 动画(骨架屏)
- 模型加载失败时提示用户刷新或检查网络

### 6.2 快捷键冲突处理
- 默认快捷键: `Ctrl+Shift+F`
- 允许用户在设置页面自定义快捷键
- 检测并提示快捷键冲突

### 6.3 无障碍设计
- 支持键盘导航(Tab 切换按钮)
- 侧边栏关闭支持 `Esc` 键
- 高对比度模式支持

---

## 七、开发优先级

### Phase 1: MVP (最小可用产品)
✅ 功能清单:
- [ ] 划词翻译(中英互译,自动检测)
- [ ] 侧边栏基础 UI
- [ ] 快捷键呼叫侧边栏
- [ ] 翻译模型集成

### Phase 2: 扩展功能
- [ ] 近义词列表
- [ ] 例句展示
- [ ] 翻译结果缓存
- [ ] 设置页面(自定义快捷键)

### Phase 3: 优化与发布
- [ ] 性能优化(加载时间 < 3 秒)
- [ ] UI/UX 打磨
- [ ] 错误处理与降级方案
- [ ] Chrome Web Store 发布

---

## 八、后续迭代方向

1. **多语言支持**: 支持日语、韩语、法语等
2. **离线词典**: 预置高频词汇的离线翻译数据
3. **学习模式**: 生词本、复习提醒
4. **自定义词库**: 允许用户添加专业术语翻译
5. **跨设备同步**: 基于 Chrome 账号同步翻译历史

---

## 九、竞品对比

| 功能 | MyDictionary | 有道划词 | 沙拉查词 |
|------|--------------|----------|----------|
| **本地 AI** | ✅ 完全本地 | ❌ 联网 | ❌ 联网 |
| **隐私保护** | ✅ 无数据上传 | ⚠️ 数据上传 | ⚠️ 数据上传 |
| **离线使用** | ✅ 支持 | ❌ 需联网 | ❌ 需联网 |
| **近义词** | ✅ AI 生成 | ✅ 词典数据 | ✅ 词典数据 |
| **例句** | ✅ AI 检索 | ✅ 固定例句 | ✅ 固定例句 |
| **响应速度** | ⚡ < 1 秒 | ⚡ < 1 秒 | ⚡ < 1 秒 |

**核心差异化**:
- ✨ 完全本地化,保护用户隐私
- ✨ 无需联网,随时随地可用
- ✨ AI 驱动,智能化程度更高
