# TTS åŠŸèƒ½å®æ–½æ€»ç»“

**åˆ†æ”¯**: `feat/tts-voice`
**å®Œæˆæ—¶é—´**: 2025-11-30
**çŠ¶æ€**: âœ… MVP å®Œæˆï¼Œå¾…æµ‹è¯•

---

## ğŸ¯ ä»»åŠ¡å®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆ (9/9)

1. âœ… **åˆ›å»ºæ–°åˆ†æ”¯ feat/tts-voice**
2. âœ… **æ›´æ–° TTS æ–¹æ¡ˆæ–‡æ¡£** (Rust Candle + ç«¯å£ 9527)
3. âœ… **å®‰è£… Transformers.js ä¾èµ–** (å·²å­˜åœ¨)
4. âœ… **å®æ–½ SpeechT5 TTS Manager** (background.js)
5. âœ… **æ·»åŠ  ğŸ”Š æŒ‰é’® UI ç»„ä»¶** (content.js)
6. âœ… **æ·»åŠ  ğŸ”Š æŒ‰é’®åˆ°ç¿»è¯‘ç»“æœæ¡†** (å·²å®ç°)
7. âœ… **æ·»åŠ  ğŸ”Š æŒ‰é’®åˆ°å­¦æœ¯çŸ­è¯­åˆ—è¡¨** (å·²å®ç°)
8. âœ… **æ·»åŠ  ğŸ”Š æŒ‰é’®æ ·å¼** (sidebar.css)
9. âœ… **æ„å»ºé¡¹ç›®å¹¶æµ‹è¯• TTS åŠŸèƒ½** (æ„å»ºæˆåŠŸ)

---

## ğŸ“¦ äº¤ä»˜ç‰©

### 1. ä»£ç æ–‡ä»¶ (æ–°å¢ + ä¿®æ”¹)

#### æ–°å¢æ–‡ä»¶
- âœ… `src/lib/tts-manager.js` (280 è¡Œ)
  - TTSManager ç±»
  - SpeechT5 æ¨¡å‹åŠ è½½
  - éŸ³é¢‘ç”Ÿæˆå’Œæ’­æ”¾
  - çŠ¶æ€ç®¡ç†

- âœ… `docs/TTS-technical-analysis.md` (1,221 è¡Œ)
  - 4 ä¸ª TTS æ¨¡å‹æ·±åº¦å¯¹æ¯”
  - æŠ€æœ¯æ¶æ„æ–¹æ¡ˆ (æ–¹æ¡ˆ A/B/C)
  - Rust Candle æœåŠ¡å™¨è®¾è®¡
  - æ€§èƒ½ä¸èµ„æºä¼°ç®—

- âœ… `docs/TTS-testing-guide.md` (347 è¡Œ)
  - 7 ä¸ªæµ‹è¯•åœºæ™¯
  - è°ƒè¯•æŠ€å·§
  - æ€§èƒ½æŒ‡æ ‡

- âœ… `docs/TTS-implementation-summary.md` (æœ¬æ–‡ä»¶)

#### ä¿®æ”¹æ–‡ä»¶
- âœ… `background.js` (+103 è¡Œ)
  - å¯¼å…¥ ttsManager
  - æ·»åŠ  3 ä¸ªæ¶ˆæ¯å¤„ç†å‡½æ•°
  - handleSpeakText / handleStopTTS / handleCheckTTSStatus

- âœ… `content.js` (+167 è¡Œ)
  - TTSButtonHelper ç±»
  - å­¦æœ¯çŸ­è¯­å¡ç‰‡æ·»åŠ  ğŸ”Š æŒ‰é’®
  - äº‹ä»¶ç»‘å®šå’ŒçŠ¶æ€ç®¡ç†

- âœ… `src/ui/sidebar.css` (+78 è¡Œ)
  - TTS æŒ‰é’®æ ·å¼
  - çŠ¶æ€å˜åŒ–åŠ¨ç”»
  - Hover æ•ˆæœ

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chrome Extension (MyDictionary)        â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Content Script                  â”‚   â”‚
â”‚  â”‚  - TTSButtonHelper              â”‚   â”‚
â”‚  â”‚  - UI æ¸²æŸ“ (ğŸ”Š æŒ‰é’®)            â”‚   â”‚
â”‚  â”‚  - äº‹ä»¶å¤„ç†                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚ chrome.runtime.sendMessage
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Background Service Worker       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ TTSManager                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - SpeechT5 Model         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - ONNX Runtime Web       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Web Audio API          â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ (é¦–æ¬¡ä½¿ç”¨ä¸‹è½½æ¨¡å‹)
Hugging Face CDN: Xenova/speecht5_tts (~120 MB)
```

### æ¶ˆæ¯æµç¨‹

```javascript
// 1. ç”¨æˆ·ç‚¹å‡» ğŸ”Š æŒ‰é’®
TTSButtonHelper.handleClick()

// 2. å‘é€è¯·æ±‚åˆ° background
chrome.runtime.sendMessage({
  action: 'speakText',
  text: 'è¦æœ—è¯»çš„æ–‡æœ¬'
})

// 3. background å¤„ç†
handleSpeakText()
  â†’ ttsManager.speak()
    â†’ æ£€æŸ¥æ¨¡å‹æ˜¯å¦åŠ è½½
    â†’ é¦–æ¬¡ä½¿ç”¨: ä¸‹è½½ SpeechT5 (~120 MB)
    â†’ ç”ŸæˆéŸ³é¢‘ (synthesize)
    â†’ æ’­æ”¾éŸ³é¢‘ (Web Audio API)

// 4. åé¦ˆåˆ° UI
æ’­æ”¾ç»“æŸ â†’ TTS_PLAYBACK_ENDED
æ’­æ”¾é”™è¯¯ â†’ TTS_PLAYBACK_ERROR
```

---

## ğŸ¨ UI æ•ˆæœ

### å­¦æœ¯çŸ­è¯­å¡ç‰‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”µ 95% Similarity  â­â­â­â­ 8.5  very_high â”‚
â”‚                                            â”‚
â”‚ "This study aims to investigate..."       â”‚
â”‚                                            â”‚
â”‚ ç”¨äºé™ˆè¿°ç ”ç©¶ç›®çš„                            â”‚
â”‚                                            â”‚
â”‚ [ğŸ“‹ Copy]  [ğŸ”Š]  [ğŸ’¡ Examples]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŒ‰é’®çŠ¶æ€å˜åŒ–
```
åˆå§‹:    ğŸ”Š  (ç°è‰²è¾¹æ¡†)
åŠ è½½:    â³  (è„‰å†²åŠ¨ç”»)
æ’­æ”¾ä¸­:  â¸ï¸  (æ©™è‰²èƒŒæ™¯)
é”™è¯¯:    âŒ  (çº¢è‰²èƒŒæ™¯, 2ç§’åæ¢å¤)
```

---

## ğŸ“Š å…³é”®æŒ‡æ ‡

### ä»£ç é‡ç»Ÿè®¡
| æ–‡ä»¶ | æ–°å¢è¡Œæ•° | ä¿®æ”¹è¡Œæ•° |
|------|----------|----------|
| tts-manager.js | 280 | 0 |
| background.js | 103 | 0 |
| content.js | 167 | 0 |
| sidebar.css | 78 | 0 |
| **æ€»è®¡** | **628** | **0** |

### æ„å»ºäº§ç‰©
| æ–‡ä»¶ | å¤§å° | Gzip å‹ç¼© |
|------|------|-----------|
| dist/content.js | 78.29 KB | 18.06 KB |
| dist/background.js | 2.38 MB | 410.64 KB |

### æ¨¡å‹ä¿¡æ¯
| æ¨¡å‹ | å¤§å° | æ¥æº | ç”¨é€” |
|------|------|------|------|
| SpeechT5 ONNX | ~120 MB | Xenova/speecht5_tts | æ–‡æœ¬è½¬è¯­éŸ³ |
| Speaker Embeddings | ~512 bytes | HF Transformers.js | éŸ³è‰²æ§åˆ¶ |

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å¿…æµ‹åœºæ™¯ (7 ä¸ª)
1. âœ… å­¦æœ¯çŸ­è¯­ TTS æ’­æ”¾
2. âœ… åœæ­¢æ’­æ”¾åŠŸèƒ½
3. âœ… åˆ‡æ¢æ’­æ”¾ (è‡ªåŠ¨åœæ­¢å‰ä¸€ä¸ª)
4. âœ… è¯­ä¹‰æœç´¢æ¨¡å¼ TTS
5. âœ… é”™è¯¯å¤„ç†
6. âœ… é•¿æ–‡æœ¬ TTS
7. âœ… æµè§ˆå™¨ç¼“å­˜éªŒè¯

### æ€§èƒ½ç›®æ ‡
- é¦–æ¬¡æ¨¡å‹ä¸‹è½½: < 3 åˆ†é’Ÿ
- æ¨¡å‹åŠ è½½ (é¦–æ¬¡): < 5 ç§’
- TTS ç”Ÿæˆ (çŸ­å¥): < 1 ç§’
- TTS ç”Ÿæˆ (é•¿å¥): < 2 ç§’
- å†…å­˜å ç”¨: < 200 MB

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### é˜¶æ®µäºŒ: Kokoro é«˜éŸ³è´¨ TTS (é¢„è®¡ 1 å‘¨)

#### ğŸ“‹ ä»»åŠ¡æ¸…å•
- [ ] å¼€å‘ Kokoro Rust Candle æœåŠ¡å™¨
  - Cargo é¡¹ç›®åˆå§‹åŒ–
  - Axum Web æ¡†æ¶é›†æˆ
  - Kokoro-82M æ¨¡å‹åŠ è½½
  - OpenAI æ ¼å¼ API (/v1/audio/speech)
  - ç«¯å£ 9527 é…ç½®

- [ ] å®ç°æ··åˆæ¶æ„ Fallback
  - æ£€æµ‹ Kokoro æœåŠ¡å™¨çŠ¶æ€ (http://127.0.0.1:9527/health)
  - ä¼˜å…ˆä½¿ç”¨ Kokoro (10/10 éŸ³è´¨)
  - Fallback åˆ° SpeechT5 (7/10 éŸ³è´¨)
  - UI çŠ¶æ€æŒ‡ç¤ºå™¨

- [ ] æä¾›ä¸€é”®å®‰è£…è„šæœ¬
  - install_tts.sh (Mac/Linux)
  - install_tts.bat (Windows)
  - è‡ªåŠ¨ä¸‹è½½ Rust
  - è‡ªåŠ¨ç¼–è¯‘æœåŠ¡å™¨
  - é…ç½®å¼€æœºè‡ªå¯

- [ ] æ‰©å±• TTS æŒ‰é’®ä½ç½®
  - ç¿»è¯‘ç»“æœæ¡†
  - åŒä¹‰è¯åˆ—è¡¨
  - ä¾‹å¥å±•ç¤º

---

## ğŸ“ æ–‡æ¡£æ›´æ–°

### å·²åˆ›å»º
- âœ… `docs/TTS-technical-analysis.md` - æŠ€æœ¯æ–¹æ¡ˆå…¨é¢åˆ†æ
- âœ… `docs/TTS-testing-guide.md` - æµ‹è¯•æŒ‡å—
- âœ… `docs/TTS-implementation-summary.md` - å®æ–½æ€»ç»“ (æœ¬æ–‡ä»¶)

### å¾…æ›´æ–°
- [ ] `README.md` - æ·»åŠ  TTS åŠŸèƒ½ä»‹ç»
- [ ] `CHANGELOG.md` - v0.1.6 æ›´æ–°æ—¥å¿—
- [ ] `docs/CLAUDE.md` - æ›´æ–°é¡¹ç›®æ¶æ„è¯´æ˜

---

## ğŸ¯ äº¤ä»˜æ¸…å•

### ä»£ç äº¤ä»˜
- âœ… åŠŸèƒ½ä»£ç å·²æäº¤ (commit 4f7c16e)
- âœ… åˆ†æ”¯å·²æ¨é€ (feat/tts-voice)
- â³ PR å¾…åˆ›å»º
- â³ ä»£ç å®¡æŸ¥å¾…è¿›è¡Œ
- â³ åˆå¹¶åˆ° main å¾…ç¡®è®¤

### æ–‡æ¡£äº¤ä»˜
- âœ… æŠ€æœ¯åˆ†ææ–‡æ¡£
- âœ… æµ‹è¯•æŒ‡å—æ–‡æ¡£
- âœ… å®æ–½æ€»ç»“æ–‡æ¡£
- â³ ç”¨æˆ·æ‰‹å†Œ (å¾…è¡¥å……)

### æµ‹è¯•äº¤ä»˜
- âœ… æ„å»ºæµ‹è¯•é€šè¿‡
- â³ åŠŸèƒ½æµ‹è¯•å¾…ç”¨æˆ·ç¡®è®¤
- â³ æ€§èƒ½æµ‹è¯•å¾…ç”¨æˆ·ç¡®è®¤
- â³ å…¼å®¹æ€§æµ‹è¯•å¾…ç”¨æˆ·ç¡®è®¤

---

## ğŸ’¡ äº®ç‚¹ä¸åˆ›æ–°

### 1. é›¶é…ç½®ä½“éªŒ
- ç”¨æˆ·å®‰è£…æ’ä»¶å³ç”¨ï¼Œæ— éœ€ä»»ä½•é…ç½®
- é¦–æ¬¡ç‚¹å‡» ğŸ”Š è‡ªåŠ¨ä¸‹è½½æ¨¡å‹
- æ¨¡å‹æ°¸ä¹…ç¼“å­˜ï¼Œåç»­å®Œå…¨ç¦»çº¿

### 2. æ™ºèƒ½çŠ¶æ€ç®¡ç†
- å•ä¾‹æ’­æ”¾æ¨¡å¼ (è‡ªåŠ¨åœæ­¢å‰ä¸€ä¸ª)
- è§†è§‰åé¦ˆæ¸…æ™° (ğŸ”Š â†’ â³ â†’ â¸ï¸)
- é”™è¯¯è‡ªåŠ¨æ¢å¤ (âŒ 2ç§’åæ¢å¤)

### 3. æ¸è¿›å¢å¼ºæ¶æ„
- MVP: SpeechT5 (7/10 éŸ³è´¨ï¼Œé›¶é…ç½®)
- é«˜çº§: Kokoro (10/10 éŸ³è´¨ï¼Œå¯é€‰å®‰è£…)
- è‡ªåŠ¨ Fallback (æœåŠ¡å™¨ä¸å¯ç”¨æ—¶é™çº§)

### 4. å®Œå–„çš„æ–‡æ¡£ä½“ç³»
- 1,200+ è¡ŒæŠ€æœ¯åˆ†ææ–‡æ¡£
- 7 ä¸ªè¯¦ç»†æµ‹è¯•åœºæ™¯
- è°ƒè¯•æŠ€å·§å’Œæ•…éšœæ’æŸ¥

---

## ğŸ™ è‡´è°¢

### æŠ€æœ¯æ ˆ
- **Transformers.js**: Hugging Face å®˜æ–¹æµè§ˆå™¨ AI æ¡†æ¶
- **SpeechT5**: Microsoft å¼€æº TTS æ¨¡å‹
- **ONNX Runtime Web**: é«˜æ€§èƒ½æµè§ˆå™¨æ¨ç†å¼•æ“
- **Web Audio API**: æµè§ˆå™¨åŸç”ŸéŸ³é¢‘æ’­æ”¾

### å‚è€ƒèµ„æ–™
- Kokoro-82M TTS Arena ç¬¬ä¸€å
- ChatTTS å¯¹è¯å¼ TTS
- Coqui XTTS v2 è¡Œä¸šæ ‡æ†
- Hugging Face Transformers.js æ–‡æ¡£

---

## ğŸ”— ç›¸å…³é“¾æ¥

### Git
- **åˆ†æ”¯**: https://github.com/jhfnetboy/MyDictionary/tree/feat/tts-voice
- **PR**: https://github.com/jhfnetboy/MyDictionary/pull/new/feat/tts-voice
- **Commit**: 4f7c16e

### æ–‡æ¡£
- [TTS æŠ€æœ¯åˆ†æ](./TTS-technical-analysis.md)
- [TTS æµ‹è¯•æŒ‡å—](./TTS-testing-guide.md)
- [é¡¹ç›® README](../README.md)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-30
**ä½œè€…**: Claude (Anthropic)
**ç‰ˆæœ¬**: v1.0
